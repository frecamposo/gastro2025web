<div metal:use-macro="load: ../shared/_layout-principal.pt">
  <div metal:fill-slot="content" tal:omit-tag="True">
    <div class="content">
      <div class="container">
        <div>
          <h2 class="mb-4">Listado de Productos</h2>
          <h4>Responsable del Ingreso <b>${login_conectado}</b></h4>

          <!-- Listado de Productos-->
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">
                Listado en Bodega
              </h6>
            </div>
            <div class="card-body">
              <div>
                <label for="min">Precio mínimo:</label>
                <input type="number" id="min" name="min" />
                <label for="max">Precio máximo:</label>
                <input type="number" id="max" name="max" />
              </div>
              <div class="table-responsive">
                <table
                  class="table table-bordered"
                  id="dataTable"
                  width="100%"
                  cellspacing="0"
                >
                  <thead>
                    <tr>
                      <th>Producto</th>
                      <th>Precio Unitario</th>
                      <th>Unidad</th>
                      <th>Stock Actual</th>
                      <th>Stock Critico</th>
                      <th>Categoria</th>
                    </tr>
                  </thead>
                  <tfoot>
                    <tr>
                      <th>Producto</th>
                      <th>Precio Unitario</th>
                      <th>Unidad</th>
                      <th>Stock Actual</th>
                      <th>Stock Critico</th>
                      <th>Categoria</th>
                    </tr>
                  </tfoot>
                  <tbody>
                    <tr tal:repeat="p productos" tal:omit-tag="False">
                      <td>${p.nom_producto}</td>
                      <td class="text-end">${'${:,}'.format(p.precio)}</td>
                      <td>${p.nom_unidad_medida}</td>
                      <td>${p.cantidad}</td>
                      <td>${p.stock_critico}</td>
                      <td>${p.nom_categ_producto}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Fin listado de productos -->
          <button class="btn btn-primary" onclick="volver()">Volver</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  function volver() {
    location.href = "/bodega";
  }
</script>

<script src="https://cdn.datatables.net/2.0.7/js/dataTables.min.js"></script>
<!-- DataTables Bootstrap 5 integration JS -->
<script src="https://cdn.datatables.net/2.0.7/js/dataTables.bootstrap5.min.js"></script>
<!-- Extensión Buttons y sus dependencias para exportación a Excel -->
<script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
<script>
  $(document).ready(function () {
    var table = $("#dataTable").DataTable({
      searching: true,
      buttons: ["copyHtml5", "excel", "csvHtml5", "pdfHtml5"],
      language: {
        url: "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json",
      },
    });

    $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
      var min = parseInt($("#min").val(), 10);
      var max = parseInt($("#max").val(), 10);
      var price = parseFloat(data[1]) || 0; // Obtiene el valor de la columna de precio (índice 1)

      if (
        (isNaN(min) && isNaN(max)) ||
        (isNaN(min) && price <= max) ||
        (min <= price && isNaN(max)) ||
        (min <= price && price <= max)
      ) {
        return true;
      }
      return false;
    });

    // Vuelve a dibujar la tabla cuando cambian los valores de los inputs
    $("#min, #max").keyup(function () {
      table.draw();
    });
  });
</script>
